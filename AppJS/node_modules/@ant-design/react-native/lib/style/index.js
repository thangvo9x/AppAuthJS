"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WithTheme = WithTheme;
exports.useTheme = exports.ThemeProvider = exports.ThemeContext = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireDefault(require("react"));

var _deepmerge = _interopRequireDefault(require("deepmerge"));

var _shallowequal = _interopRequireDefault(require("shallowequal"));

var _default = _interopRequireDefault(require("./themes/default"));

var ThemeContext = /*#__PURE__*/_react["default"].createContext(_default["default"]);

exports.ThemeContext = ThemeContext;

var ThemeProvider = function ThemeProvider(props) {
  var value = props.value,
      children = props.children;

  var theme = _react["default"].useMemo(function () {
    return (0, _extends2["default"])((0, _extends2["default"])({}, _default["default"]), value);
  }, [value]);

  return /*#__PURE__*/_react["default"].createElement(ThemeContext.Provider, {
    value: theme
  }, children);
};

exports.ThemeProvider = ThemeProvider;

var useTheme = function useTheme() {
  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var theme = _react["default"].useContext(ThemeContext);

  return (0, _extends2["default"])((0, _extends2["default"])({}, theme), props.theme);
};

exports.useTheme = useTheme;

function WithTheme(props) {
  var children = props.children,
      themeStyles = props.themeStyles,
      styles = props.styles;

  var stylesRef = _react["default"].useRef(undefined);

  var cache = _react["default"].useRef(undefined);

  var getStyles = _react["default"].useCallback(function (theme) {
    if (themeStyles && cache.current === undefined) {
      cache.current = themeStyles(theme);
    } // TODO: check these styles has changed


    if (styles && !(0, _shallowequal["default"])(stylesRef.current, styles)) {
      stylesRef.current = styles; // merge styles from user defined

      cache.current = (0, _deepmerge["default"])(cache.current, styles);
    }

    return cache.current || {};
  }, [themeStyles, styles]);

  return /*#__PURE__*/_react["default"].createElement(ThemeContext.Consumer, null, function (theme) {
    return children(getStyles(theme), theme);
  });
}